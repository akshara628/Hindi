<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§µ‡•ç‡§Ø‡§Ç‡§ú‡§®-‡§¨‡•ç‡§≤‡•á‡§Ç‡§°‡•ç‡§∏ √ó ‡§∏‡•ç‡§µ‡§∞ ‚Äî ‡§â‡§ö‡•ç‡§ö‡§æ‡§∞‡§£ ‡§µ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏</title>
<style>
  body{
    font-family: "Noto Sans Devanagari", "Mangal", Arial, sans-serif;
    background:#fffdf8; color:#222; padding:18px;
  }
  header{ text-align:center; margin-bottom:12px; }
  h1{ color:#b22222; margin:6px 0; }
  p.lead{ color:#444; margin:0 0 12px; }
  .grid{ display:grid; grid-template-columns: 1fr 360px; gap:16px; }
  .card{
    background:#fff; border-radius:12px; padding:12px;
    box-shadow:0 6px 18px rgba(20,30,60,0.06);
    overflow:auto;
  }
  table{ width:100%; border-collapse:collapse; font-size:1rem; }
  th,td{ border:1px solid #eee; padding:8px; text-align:center; vertical-align:middle; }
  th{ background:#fff1e6; position:sticky; top:0; z-index:1; color:#b22222; font-weight:700; }
  td span.syl{ display:block; font-size:1.2rem; cursor:pointer; color:#0a4da2; font-weight:700; }
  td small.trans{ display:block; color:green; font-style:italic; margin-top:4px; font-size:0.9rem; }
  td:hover{ background:#fbf8f2; }
  /* Practice panel */
  .practice h2{ margin:0 0 8px; color:#0a4da2; }
  .controls{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-bottom:10px; }
  button.btn{ background:#0a4da2; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700; }
  button.secondary{ background:#fff; color:#0a4da2; border:2px solid #0a4da2; }
  #options{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:10px; }
  #options button.opt{ background:#4a90e2; color:white; padding:8px 10px; border-radius:8px; border:none; cursor:pointer; font-weight:700; min-width:120px; }
  #feedback{ margin-top:10px; text-align:center; font-weight:700; min-height:26px; }
  .small{ font-size:0.9rem; color:#444; }
  footer{ margin-top:12px; text-align:center; color:#666; font-size:0.9rem; }
  @media(max-width:980px){ .grid{ grid-template-columns: 1fr; } .practice{ order:-1; } }
</style>
</head>
<body>
<header>
  <h1>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§µ‡•ç‡§Ø‡§Ç‡§ú‡§®-‡§¨‡•ç‡§≤‡•á‡§Ç‡§°‡•ç‡§∏ √ó ‡§∏‡•ç‡§µ‡§∞</h1>
  <p class="lead">‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§ï‡§ï‡•ç‡§∑ (cell) ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‚Äî ‡§¶‡•á‡§µ‡§®‡§æ‡§ó‡§∞‡•Ä ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§¨‡•ã‡§≤‡•á‡§ó‡§æ ‡§î‡§∞ ‡§®‡•Ä‡§ö‡•á Roman transliteration ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ‡•§ Practice Mode ‡§∏‡•á ‡§∏‡•Å‡§®‡§ï‡§∞ ‡§™‡§π‡§ö‡§æ‡§®‡•á‡§Ç‡•§</p>
  <div class="controls" style="justify-content:center;">
    <button class="btn" id="detectVoices">üîç Detect Voices</button>
    <button class="btn secondary" id="installNote">üìå If no Hindi sound: install device Hindi voice</button>
  </div>
</header>

<div class="grid">
  <div class="card" style="max-height:74vh;">
    <table id="blendTable" aria-label="Hindi blends table">
      <thead>
        <tr>
          <th>‡§¨‡•ç‡§≤‡•á‡§Ç‡§° / ‡§µ‡•ç‡§Ø‡§Ç‡§ú‡§®</th>
          <th>+ ‡§Ö</th>
          <th>+ ‡§Ü</th>
          <th>+ ‡§á</th>
          <th>+ ‡§à</th>
          <th>+ ‡§â</th>
          <th>+ ‡§ä</th>
          <th>+ ‡§è</th>
          <th>+ ‡§ê</th>
          <th>+ ‡§ì</th>
          <th>+ ‡§î</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <aside class="card practice">
    <h2>üéÆ Practice Mode</h2>
    <p class="small">Play a syllable and choose the right written form. Use the dropdown to set options per round.</p>
    <div style="display:flex;gap:8px;justify-content:center;margin-bottom:8px;">
      <button class="btn" id="playSound">üîä Play Sound</button>
      <button class="btn secondary" id="newRound">‚ü≤ New Round</button>
    </div>

    <div style="display:flex;gap:8px;justify-content:center;align-items:center;margin-bottom:8px;">
      <label class="small">Options:
        <select id="numOptions" style="margin-left:6px;">
          <option>3</option><option selected>4</option><option>6</option>
        </select>
      </label>
      <label class="small" style="margin-left:8px;">Only clusters:
        <input type="checkbox" id="onlyClusters" style="margin-left:6px;">
      </label>
    </div>

    <div id="options" role="list"></div>
    <div id="feedback"></div>

    <div style="margin-top:10px;color:#555;font-size:0.9rem;">
      Total combos: <span id="totalCombos">0</span>
    </div>
    <hr style="margin:10px 0;">
    <div class="small">Tip: If you don't hear Hindi voice, tap "Detect Voices" then install Hindi voice in device settings (Android: Settings ‚Üí Text-to-speech ‚Üí Install voice data ‚Üí Hindi).</div>
  </aside>
</div>

<footer>Designed for learners ‚Äî blends include common consonant clusters such as ‡§ï‡•ç‡§∞, ‡§§‡•ç‡§∞, ‡§™‡•ç‡§∞, ‡§∂‡•ç‡§∞, ‡§ï‡•ç‡§∑, ‡§ú‡•ç‡§û and many more.</footer>

<script>
/* ---------------------------
   Data: blends and translit map
   --------------------------- */

// Devanagari vowel marks corresponding to: ‡§Ö, ‡§Ü, ‡§á, ‡§à, ‡§â, ‡§ä, ‡§è, ‡§ê, ‡§ì, ‡§î
const vowelMarks = ["","‡§æ","‡§ø","‡•Ä","‡•Å","‡•Ç","‡•á","‡•à","‡•ã","‡•å"];
const vowelRoman = ["a","aa","i","ee","u","oo","e","ai","o","au"];

// Core blends list (consonants + common clusters).
// This list focuses on commonly used clusters frequently seen in textbooks and spoken Hindi.
const blends = [
  // single consonants (as 'blends' for this table)
  "‡§ï","‡§ñ","‡§ó","‡§ò","‡§ö","‡§õ","‡§ú","‡§ù","‡§ü","‡§†","‡§°","‡§¢","‡§§","‡§•","‡§¶","‡§ß","‡§®",
  "‡§™","‡§´","‡§¨","‡§≠","‡§Æ","‡§Ø","‡§∞","‡§≤","‡§µ","‡§∂","‡§∑","‡§∏","‡§π",

  // common two-letter clusters (consonant+consonant)
  "‡§ï‡•ç‡§∞","‡§ó‡•ç‡§∞","‡§§‡•ç‡§∞","‡§™‡•ç‡§∞","‡§¨‡•ç‡§∞","‡§´‡•ç‡§∞","‡§¶‡•ç‡§∞","‡§ß‡•ç‡§∞","‡§§‡•ç‡§∞","‡§∏‡•ç‡§µ","‡§∏‡•ç‡§®","‡§∏‡•ç‡§Æ","‡§∏‡•ç‡§™","‡§∏‡•ç‡§§","‡§∏‡•ç‡§•","‡§∏‡•ç‡§ï","‡§∏‡•ç‡§ï‡•ç‡§∞","‡§∏‡•ç‡§ü‡•ç‡§∞","‡§∂‡•ç‡§∞","‡§ù‡•ç‡§∞",

  // special clusters / conjuncts
  "‡§ï‡•ç‡§∑","‡§ú‡•ç‡§û","‡§§‡•ç‡§∞","‡§∂‡•ç‡§∞","‡§π‡•ç‡§®","‡§∞‡•ç‡§®","‡§∞‡•ç‡§≤","‡§≤‡•ç‡§™","‡§∞‡•ç‡§™","‡§ï‡•ç‡§§","‡§®‡•ç‡§•","‡§û‡•ç‡§ö","‡§û‡•ç‡§ú","‡§¶‡•ç‡§Æ",

  // more useful clusters learners meet (s-prefixed, etc.)
  "‡§∏‡•ç‡§ï","‡§∏‡•ç‡§™‡•ç‡§∞","‡§∏‡•ç‡§™‡•ç‡§≤","‡§∏‡•ç‡§´","‡§∏‡•ç‡§∞","‡§∏‡•ç‡§ü","‡§∏‡•ç‡§ü‡•ç‡§∞","‡§∏‡•ç‡§ï‡•ç‡§∞","‡§∏‡•ç‡§µ","‡§∂‡•ç‡§∞","‡§∏‡•ç‡§•","‡§∏‡•ç‡§§‡•ç‡§∞","‡§∂‡•ç‡§µ","‡§π‡•ç‡§∞","‡§ï‡•ç‡§∞‡•ç‡§Ø"
];

// remove duplicates and keep order
const uniqueBlends = Array.from(new Set(blends));

// transliteration mapping for base clusters
// This is a practical, readable romanization (not strict IPA). Adjust as required.
const translitMap = {
  "‡§ï":"k","‡§ñ":"kh","‡§ó":"g","‡§ò":"gh","‡§ö":"ch","‡§õ":"chh","‡§ú":"j","‡§ù":"jh","‡§ü":"·π≠","‡§†":"·π≠h",
  "‡§°":"·∏ç","‡§¢":"·∏çh","‡§§":"t","‡§•":"th","‡§¶":"d","‡§ß":"dh","‡§®":"n",
  "‡§™":"p","‡§´":"ph","‡§¨":"b","‡§≠":"bh","‡§Æ":"m","‡§Ø":"y","‡§∞":"r","‡§≤":"l","‡§µ":"v","‡§∂":"sh",
  "‡§∑":"·π£","‡§∏":"s","‡§π":"h",
  // common clusters
  "‡§ï‡•ç‡§∞":"kr","‡§ó‡•ç‡§∞":"gr","‡§§‡•ç‡§∞":"tr","‡§™‡•ç‡§∞":"pr","‡§¨‡•ç‡§∞":"br","‡§´‡•ç‡§∞":"fr","‡§¶‡•ç‡§∞":"dr","‡§ß‡•ç‡§∞":"dhr",
  "‡§∏‡•ç‡§µ":"sv","‡§∏‡•ç‡§®":"sn","‡§∏‡•ç‡§Æ":"sm","‡§∏‡•ç‡§™":"sp","‡§∏‡•ç‡§§":"st","‡§∏‡•ç‡§•":"sth","‡§∏‡•ç‡§ï":"sk","‡§∏‡•ç‡§ï‡•ç‡§∞":"skr","‡§∏‡•ç‡§ü‡•ç‡§∞":"str",
  "‡§∂‡•ç‡§∞":"shr","‡§ù‡•ç‡§∞":"jhr","‡§ï‡•ç‡§∑":"ksh","‡§ú‡•ç‡§û":"gy","‡§π‡•ç‡§®":"hn","‡§∞‡•ç‡§®":"rn","‡§∞‡•ç‡§≤":"rl","‡§≤‡•ç‡§™":"alp","‡§∞‡•ç‡§™":"rp",
  "‡§ï‡•ç‡§§":"kt","‡§®‡•ç‡§•":"nth","‡§û‡•ç‡§ö":"nch","‡§û‡•ç‡§ú":"nj","‡§¶‡•ç‡§Æ":"dm","‡§∏‡•ç‡§™‡•ç‡§∞":"spr","‡§∏‡•ç‡§™‡•ç‡§≤":"spl","‡§∏‡•ç‡§´":"sph","‡§∏‡•ç‡§∞":"sr",
  "‡§∏‡•ç‡§ü":"st","‡§∏‡•ç‡§ü‡•ç‡§∞":"str","‡§∏‡•ç‡§ï‡•ç‡§∞":"skr","‡§∏‡•ç‡§§‡•ç‡§∞":"str","‡§∂‡•ç‡§µ":"shv","‡§π‡•ç‡§∞":"hr","‡§ï‡•ç‡§∞‡•ç‡§Ø":"kry"
};

// fallback: for any blend not in map, approximate by joining char translits
function approximateTranslit(blend){
  // break into characters and map if possible else use the character itself
  const chars = Array.from(blend);
  const parts = chars.map(ch => translitMap[ch] || ch);
  return parts.join("");
}

/* ---------------------------
   Build table
   --------------------------- */
const tbody = document.querySelector("#blendTable tbody");

function buildTable(){
  tbody.innerHTML = "";
  uniqueBlends.forEach(b => {
    const tr = document.createElement("tr");
    const tdBlend = document.createElement("td");
    tdBlend.textContent = b;
    tdBlend.style.fontWeight = "700";
    tr.appendChild(tdBlend);

    for (let i=0;i<vowelMarks.length;i++){
      const td = document.createElement("td");
      // form syllable: b + vowel mark (note: for '‡§ø' the visual position is before character,
      // but writing b + mark works for display)
      const syl = b + vowelMarks[i];
      // translit: base + vowelRoman
      const baseRoman = translitMap[b] || approximateTranslit(b);
      const roman = baseRoman + vowelRoman[i];
      const span = document.createElement("span");
      span.className = "syl";
      span.textContent = syl;
      span.tabIndex = 0;
      // small transliteration line
      const small = document.createElement("small");
      small.className = "trans";
      small.textContent = roman;

      // click -> speak
      span.addEventListener("click", () => speakSyllable(syl));
      span.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") speakSyllable(syl); });

      td.appendChild(span);
      td.appendChild(small);
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  });

  refreshCombos();
}
buildTable();

/* ---------------------------
   Speech synthesis: auto-detect Hindi voice
   --------------------------- */

let preferredVoice = null;
let voicesReady = false;

function detectHindiVoice(){
  const voices = speechSynthesis.getVoices();
  // pick first voice whose lang starts with 'hi' or whose name contains 'Hindi'
  preferredVoice = voices.find(v => v.lang && v.lang.toLowerCase().startsWith("hi"))
    || voices.find(v => /hindi/i.test(v.name))
    || voices.find(v => v.lang && v.lang.toLowerCase().includes("in")); // fallback to Indian voices
  voicesReady = true;
  return preferredVoice;
}

// voices may load asynchronously
speechSynthesis.onvoiceschanged = () => {
  detectHindiVoice();
  document.getElementById("detectVoices").textContent = preferredVoice ? `üé§ Voice: ${preferredVoice.name}` : "üîç Detect Voices";
};

document.getElementById("detectVoices").addEventListener("click", ()=>{
  const v = detectHindiVoice();
  const btn = document.getElementById("detectVoices");
  if (v) btn.textContent = `üé§ Voice: ${v.name} (${v.lang})`;
  else btn.textContent = "‚ö†Ô∏è No Hindi voice found (install voice data)";
});

/* speak function */
function speakSyllable(text){
  // cancel any existing utterances
  speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(text);
  // prefer detected Hindi voice
  if (!voicesReady) detectHindiVoice();
  if (preferredVoice) {
    utter.voice = preferredVoice;
    utter.lang = preferredVoice.lang || "hi-IN";
  } else {
    // set hi-IN and let browser pick best available
    utter.lang = "hi-IN";
  }
  // slower for clarity
  utter.rate = 0.85;
  utter.pitch = 1.0;
  speechSynthesis.speak(utter);
}

/* ---------------------------
   Practice Mode
   --------------------------- */
let allCombos = []; // strings like '‡§ï‡•ç‡§∞‡§æ'
function refreshCombos(){
  allCombos = [];
  uniqueBlends.forEach(b => {
    vowelMarks.forEach((m, idx) => {
      allCombos.push({blend:b, syl: b + m, roman: (translitMap[b]||approximateTranslit(b)) + vowelRoman[idx]});
    });
  });
  document.getElementById("totalCombos").textContent = allCombos.length;
}
refreshCombos();

const playBtn = document.getElementById("playSound");
const optionsEl = document.getElementById("options");
const feedbackEl = document.getElementById("feedback");
const numOptionsSelect = document.getElementById("numOptions");
const onlyClustersCheckbox = document.getElementById("onlyClusters");
const newRoundBtn = document.getElementById("newRound");

let currentCorrect = null;

function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function getCandidatePool(){
  let pool = allCombos.slice();
  if (onlyClustersCheckbox.checked){
    // filter to blends with length>1 (clusters) - many are multi-char already
    pool = pool.filter(it => it.blend.length > 1);
  }
  return pool;
}

function startRound(){
  feedbackEl.textContent = "";
  optionsEl.innerHTML = "";
  const pool = getCandidatePool();
  if (pool.length === 0){
    feedbackEl.textContent = "No combos available with current filters.";
    return;
  }
  currentCorrect = pickRandom(pool);
  // speak it
  speakSyllable(currentCorrect.syl);

  // build options
  const n = parseInt(numOptionsSelect.value,10) || 4;
  const opts = new Set([currentCorrect.syl]);
  const candidatePool = pool.map(it => it.syl).filter(s => s !== currentCorrect.syl);

  while (opts.size < n && candidatePool.length > 0){
    const idx = Math.floor(Math.random()*candidatePool.length);
    opts.add(candidatePool.splice(idx,1)[0]);
  }
  // if still not enough, fill from all combos
  while (opts.size < n){
    opts.add(pickRandom(allCombos).syl);
  }
  const arr = Array.from(opts).sort(()=>Math.random()-0.5);
  arr.forEach(syl => {
    const btn = document.createElement("button");
    btn.className = "opt";
    btn.textContent = syl;
    btn.addEventListener("click", ()=> checkAnswer(syl));
    optionsEl.appendChild(btn);
  });
}

function checkAnswer(choice){
  if (!currentCorrect) return;
  if (choice === currentCorrect.syl){
    feedbackEl.textContent = "‚úÖ ‡§∏‡§π‡•Ä! ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§ï‡§ø‡§Ø‡§æ‡•§";
    feedbackEl.style.color = "green";
  } else {
    feedbackEl.textContent = `‚ùå ‡§ó‡§≤‡§§ ‚Äî ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞: "${currentCorrect.syl}"`;
    feedbackEl.style.color = "crimson";
    // speak correct after short pause
    setTimeout(()=> speakSyllable(currentCorrect.syl), 650);
  }
  currentCorrect = null;
}

playBtn.addEventListener("click", startRound);
newRoundBtn.addEventListener("click", startRound);
numOptionsSelect.addEventListener("change", ()=> {
  // nothing immediate
});
onlyClustersCheckbox.addEventListener("change", ()=> {
  // update total combos display
  document.getElementById("totalCombos").textContent = getCandidatePool().length;
});

/* initial attempt to detect voices (some browsers need user gesture to populate) */
setTimeout(()=> {
  if (speechSynthesis.getVoices().length) detectHindiVoice();
}, 500);

</script>
</body>
</html>
